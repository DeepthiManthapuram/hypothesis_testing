# -*- coding: utf-8 -*-
"""Welcome to Colab

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/notebooks/intro.ipynb

# Welcome to Colab!
"""

import seaborn as sns
df = sns.load_dataset("taxis")
print("first 5 rows : ",df.head(5))
print("shape : ",df.shape)
print("Info : ",df.info())
print("size : " ,df.size)
print("no of dimensions :",df.ndim)
print("describe : ",df.describe)
print("columns : ",df.columns)



df.describe() #numerical columns

print(df.isna()) #missing values

percentage_of_missing_values_to_delete = ((df.shape[0]-df.dropna().shape[0])/df.shape[0])*100 #it should be less than 10
print("percentage_of_missing_values_to_delete : ",percentage_of_missing_values_to_delete)

df.reset_index(drop = True)

df.describe(include = "object")

#EDA
#tip is numerical feature, analyze with color feature which is categorical
df.color.value_counts() #to find which hypothesis test we can use

#graphical analysis of categorical
sns.barplot(x = df.color, y=df.tip, estimator = 'mean')

"""In the above barplot,
a) yellow has more tip average than green
b) customers in yellow group tip more
"""

df.color.value_counts()

import matplotlib.pyplot as plt
sns.histplot(x = df.tip, hue = df.color,kde = True, palette = ['red','green'])

"""In above histogram,
a) most tips are small, few large.
b) most tips fall between 0-5 units and long tail upto 30 units.

#hypothesis

Ho : distribution of tip for yellow=distribution of tip for green
H1 : distribution of tip for yellow != distribution of tip for green
"""

yellow_tip = df['tip'][df['color']=='yellow']
green_tip=df['tip'][df['color']=='green']
print(yellow_tip.shape)
print(green_tip.shape)

# Independent T-Test
from scipy import stats

t_stat, p_val = stats.ttest_ind(yellow_tip,green_tip)
print("Independent T-Test statistic:", t_stat)
print("P-value:", p_val)

if p_val < 0.05: #0.05 is significance level(alpha)
    print("Reject null hypothesis: Income differs by Gender")
else:
    print("Fail to reject null hypothesis: No significant income difference by Gender")

"""Payment column"""

import seaborn as sns
df = sns.load_dataset("taxis")
print(df.payment.value_counts())

#graphical analysis of categorical
sns.barplot(x = df.payment, y=df.tip, estimator = 'mean')

import matplotlib.pyplot as plt
sns.histplot(x = df.tip, hue = df.payment,kde = True, palette = ['red','green'])

"""Credit card payments have a significantly higher average tip than cash payments.

Cash payments are more frequent, but tips are mostly zero or negligible.

Credit card tips show greater variability and include higher tip values, indicating stronger tipping behavior when paying digitally.
Number of customers who pay through cash are higher than the credit card payers.

#hypothesis

Ho : distribution of tip for creditcard=distribution of tip for cash
H1 : distribution of tip for creditcard!= distribution of tip for cash
"""

credit_tip = df['tip'][df['payment']=='credit card']
cash_tip=df['tip'][df['payment']=='cash']
print(credit_tip.shape)
print(credit_tip.shape)

# Independent T-Test
from scipy import stats

t_stat, p_val = stats.ttest_ind(credit_tip,cash_tip)
print("Independent T-Test statistic:", t_stat)
print("P-value:", p_val)

if p_val < 0.05: #0.05 is significance level(alpha)
    print("Reject null hypothesis: tip differs by payment")
else:
    print("Fail to reject null hypothesis: No significant tip difference by payment")

"""Hypotheses:

H0: distribution of tip is the same across all pickup_borough categories

H1: At least one category has a different distribution of tip
"""

manhattan_tip = df['tip'][df['pickup_borough'] == 'Manhattan']
Queens_tip = df['tip'][df['pickup_borough'] == 'Queens']
Bronx_tip = df['tip'][df['pickup_borough'] == 'Bronx']
Brooklyn_tip = df['tip'][df['pickup_borough'] == 'Brooklyn']


# ANOVA Test
#it gives whether the groups are similar are not
#regions = [group['Spending_Score'].values for name, group in df.groupby('pickup_borough')]

f_stat, p_val = stats.f_oneway(manhattan_tip,Queens_tip,Bronx_tip,Brooklyn_tip)
print("ANOVA f-statistic:", f_stat)
print("P-value:", p_val)

if p_val < 0.05:
    print("Reject null hypothesis: ")
else:
    print("Fail to reject null hypothesis: No significant difference by Region")

sns.histplot(hue=df['pickup_borough'],x=df['tip'],bins=20,kde=True)

import seaborn as sns
df = sns.load_dataset("taxis")
borough_counts = df['pickup_borough'].value_counts()

sns.barplot(
    x=borough_counts.index,
    y=borough_counts.values,
    palette='Set2'
)

plt.xlabel('pickup_borough')
plt.ylabel('count')
plt.title('Number of Trips per pickup Borough')
plt.show()

import pandas as pd
from scipy import stats
from statsmodels.stats.multicomp import pairwise_tukeyhsd

# ---------- Data Cleaning ----------
# Keep only required columns and remove missing values
df_clean = df[['tip', 'pickup_borough']].dropna()

# Ensure correct data types
df_clean['tip'] = pd.to_numeric(df_clean['tip'], errors='coerce')
df_clean['pickup_borough'] = df_clean['pickup_borough'].astype(str)

# Remove any rows that became NaN after conversion
df_clean = df_clean.dropna()

# ---------- Create groups ----------
manhattan_tip = df_clean[df_clean['pickup_borough'] == 'Manhattan']['tip']
queens_tip = df_clean[df_clean['pickup_borough'] == 'Queens']['tip']
bronx_tip = df_clean[df_clean['pickup_borough'] == 'Bronx']['tip']
brooklyn_tip = df_clean[df_clean['pickup_borough'] == 'Brooklyn']['tip']

# ---------- ANOVA Test ----------
f_stat, p_val = stats.f_oneway(
    manhattan_tip,
    queens_tip,
    bronx_tip,
    brooklyn_tip
)

print("ANOVA F-statistic:", f_stat)
print("ANOVA p-value:", p_val)

# ---------- Tukey HSD Test ----------
if p_val < 0.05:
    tukey = pairwise_tukeyhsd(
        endog=df_clean['tip'],
        groups=df_clean['pickup_borough'],
        alpha=0.05
    )
    print(tukey)
else:
    print("No significant difference found by ANOVA")

"""Hypotheses for correlation for numeric variables:

H0: correlation is zero

H1: there is significant correlation (not zero)
"""

sns.histplot(df['passengers'],kde=True)

sns.scatterplot(x=df.tip,y=df.passengers)

r,p_val=stats.spearmanr(df['tip'],df['passengers'])
print("correlation:",r)
print('P-value:',p_val)
if p_val<0.05:
    print('Reject null hypothesis')
else:
    print("Fail to reject null hypothesis")

sns.scatterplot(x=df.tip,y=df.fare)

sns.histplot(df['fare'],kde=True)

r,p_val=stats.spearmanr(df['tip'],df['fare'])
print("correlation:",r)
print('P-value:',p_val)
if p_val<0.05:
    print('Reject null hypothesis')
else:
    print("Fail to reject null hypothesis")


sns.histplot(df['distance'],kde=True)



sns.scatterplot(x=df.tip,y=df.distance)


r,p_val=stats.spearmanr(df['tip'],df['distance'])
print("correlation:",r)
print('P-value:',p_val)
if p_val<0.05:
    print('Reject null hypothesis')
else:
    print("Fail to reject null hypothesis")